@using Era_sphere.Areas.AreaReservas
@using Era_sphere.Generics;
@using Telerik.Web.Mvc.UI
@model IEnumerable<ReservaView>
@{
    ViewBag.Title = "CheckInCheckOut";
    var hotelID = (int)ViewData["hotelID"];
    Layout = "~/Views/Shared/_Layout.cshtml";
    // var paises = (new EraSphereContext()).paises.ToList();
    // var ciudades = (new EraSphereContext()).ciudades.ToList();
    var estados = (new EraSphereContext()).estados_reserva.ToList();
}
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

<div class="block big" style="position: relative">
    <!-- Block Begin -->
    <div class="titlebar">
        <h3>
            Realizar check in - check out
        </h3>
    </div>
    <div class="block_cont">
        @(Html.Telerik().Grid(Model)
        .Name("CheckInCheckOutGrid")
        .Localizable("es-ES")
        .Filterable()
      

        .DataKeys(key => key.Add(c => c.ID))
        .Columns(columns =>
        {
            columns.Bound(p => p.responsable_pago);
            columns.Bound(p => p.documento_identidad).Title("Documento");
            columns.Bound(p => p.codigo);
            columns.ForeignKey(p => p.estadoID, new SelectList(estados, "ID", "descripcion"));
            columns.Command(commands =>
            {

                commands
                    .Custom("Check-In")
                    .Text("Check-In")
                    .DataRouteValues(route => route.Add(o => o.ID).RouteKey("reserva_id"))
                    .Ajax(true)
                    .Action("Nada", "CheckInCheckOut")
                .HtmlAttributes(new { style = "text-align: center" });
                commands
                    .Custom("Check-Out")
                    .Text("Check-Out")
                    .DataRouteValues(route => route.Add(o => o.ID).RouteKey("reserva_id"))
                    .Ajax(true)
                    .Action("Nada", "CheckInCheckOut");
                commands
                    .Custom("RealizarCorteCuenta")
                    .Text("Corte Cuenta")
                    .DataRouteValues(route => route.Add(o => o.ID).RouteKey("reserva_id"))
                    .Ajax(true)
                    .Action("Nada", "CheckInCheckOut");
            });

        }).Pageable().Sortable()

        .ClientEvents(events =>
        {
            events.OnComplete("completado");
        })
        
        .DataBinding(dataBinding => dataBinding
            .Ajax()
            .Select("Select", "CheckInCheckOut", new { id = @hotelID })
         

            )
                                                               )
                                                               
    <p>@Html.ActionLink("Ver gestionar reservas", "Index", new { controller = "../AreaReservas/Reserva", ID = @hotelID, partial = false },
                            new { @class = "tipTop" }
                        )
    </div> 
    <!-- Table Wrapper End -->
</div>

@(Html.Telerik().Window()
    .Name("CheckIn").Title("Check-In")
    .Content(@<text><div id="RegitrarCheckIn">
    </div></text>).Visible(false).Width(600).Height(400).Scrollable(true)
    )


    @(Html.Telerik().Window()
    .Name("CheckOut").Title("Check-Out")
    .Content(@<text><div id="RegitrarCheckOut">
    </div></text>).Visible(false).Width(600).Height(400).Scrollable(true)
    )
    @(Html.Telerik().Window()
    .Name("Cortecuenta").Title("CorteDeCuenta")
    .Content(@<text><div id="cortecuentadiv">
    </div></text>).Visible(false).Width(600).Height(400).Scrollable(true)
    )
<script type="text/javascript">
   
    function completado(e) {
        if (e.name == "Check-In") {

            $("#RegitrarCheckIn").load('@Url.Action("CheckIn", "../AreaReservas/CheckInCheckOut")' + '?reserva_id=' + e.response.reserva_id);
            $("#CheckIn").data("tWindow").center().open();
            $("#CheckInCheckOutGrid").data("tGrid").ajaxRequest();
        }
        else
            if (e.name == "Check-Out") {
                $("#RegitrarCheckOut").load('@Url.Action("CheckOut", "../AreaReservas/CheckInCheckOut")' + '?reserva_id=' + e.response.reserva_id);
                $("#CheckOut").data("tWindow").center().open();
            }
            else if (e.name == "RealizarCorteCuenta") {
                $("#cortecuentadiv").load('@Url.Action("CorteDeCuenta", "../AreaContable/Pagos")', {reservaID : e.response.reserva_id});
                $("#Cortecuenta").data("tWindow").center().open();
            } 
        
    }
</script>
